<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ambulancias</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="print.css" media="print" />
</head>
<body>
  <header class="topbar">
    <button id="btnBack" class="back hidden" type="button">â† MenÃº</button>
    <div class="title">Ambulancias</div>
    <div class="right">
      <span id="savePill" class="pill">Listo</span>
      <button id="btnLogout" class="ghost hidden" type="button">Salir</button>
    </div>
  </header>

  <!-- LOGIN -->
  <section id="viewAuth" class="view active">
    <div class="card">
      <h1>Iniciar sesiÃ³n</h1>
      <p class="muted">Acceso con credenciales. Roles y permisos administrados por el administrador.</p>

      <div class="grid2">
        <div>
          <label>Email</label>
          <input id="authEmail" type="email" autocomplete="username" placeholder="correo@dominio.com" />
        </div>
        <div>
          <label>ContraseÃ±a</label>
          <input id="authPass" type="password" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </div>
      </div>

      <div class="row">
        <button id="btnLogin" class="primary" type="button">Entrar</button>
        <button id="btnForgot" class="secondary" type="button">OlvidÃ© mi contraseÃ±a</button>
      </div>

      <div id="authMsg" class="msg"></div>

      <details style="margin-top:10px">
        <summary class="muted">Ayuda</summary>
        <ul>
          <li>Si es tu primera vez, el administrador debe crear tu usuario.</li>
          <li>Si olvidaste tu contraseÃ±a, usa â€œOlvidÃ© mi contraseÃ±aâ€.</li>
        </ul>
      </details>
    </div>
  </section>

  <!-- MENU -->
  <section id="viewHome" class="view">
    <div class="card">
      <h2>MenÃº</h2>
      <div class="menu">
        <button id="navInventario" class="big">ğŸ“¦ Inventario de ambulancia</button>
        <button id="navMecanica" class="big">ğŸ› ï¸ RevisiÃ³n mecÃ¡nica</button>
        <button id="navExpediente" class="big">ğŸ—‚ï¸ Expediente y hoja de trabajo</button>
        <button id="navUsers" class="big" data-permission="manage_users">ğŸ‘¥ Usuarios</button>
      </div>

      <div class="card subcard">
        <h3>Registros</h3>

        <div class="row wrap">
          <button id="btnNew" class="secondary" type="button">â• Nuevo</button>
          <button id="btnSave" class="primary" type="button">ğŸ’¾ Guardar</button>
          <button id="btnExport" class="secondary" type="button">â¬‡ï¸ Exportar JSON</button>
          <label class="fileBtn secondary">
            â¬†ï¸ Importar JSON
            <input id="fileImport" type="file" accept=".json,application/json" />
          </label>
        </div>

        <div class="row">
          <input id="search" type="search" placeholder="Buscar registroâ€¦" />
          <button id="btnRefresh" class="secondary" type="button">Actualizar</button>
        </div>

        <div id="recordsList" class="records"></div>
        <div class="hint muted">Guardado en la nube (Firestore) con permisos por usuario.</div>
      </div>
    </div>
  </section>

  <!-- INVENTARIO -->
  <section id="viewInventario" class="view">
    <div class="card">
      <h2>ğŸ“¦ Inventario de ambulancia</h2>
      <div class="grid2">
        <div><label>Unidad</label><input id="inv_unit" /></div>
        <div><label>Fecha</label><input id="inv_date" type="date" /></div>
        <div><label>Responsable</label><input id="inv_resp" /></div>
        <div><label>Turno</label><input id="inv_shift" /></div>
      </div>

      <div class="row wrap">
        <button id="inv_addRow" class="secondary" type="button">â• Agregar fila</button>
        <button id="inv_clear" class="secondary" type="button">ğŸ§¹ Limpiar tabla</button>
      </div>

      <div class="tableWrap">
        <table id="inv_table">
          <thead>
            <tr>
              <th>Ãtem</th><th>Cantidad</th><th>Estado</th><th>Vencimiento</th><th>Notas</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- MECÃNICA -->
  <section id="viewMecanica" class="view">
    <div class="card">
      <h2>ğŸ› ï¸ RevisiÃ³n mecÃ¡nica</h2>
      <div class="grid2">
        <div><label>Unidad</label><input id="mech_unit" /></div>
        <div><label>Fecha</label><input id="mech_date" type="date" /></div>
        <div><label>Kilometraje</label><input id="mech_km" type="number" /></div>
        <div><label>Responsable</label><input id="mech_resp" /></div>
      </div>

      <h3>Checklist</h3>
      <div class="checkgrid">
        <label><input type="checkbox" id="mech_chk_oil" /> Aceite</label>
        <label><input type="checkbox" id="mech_chk_tires" /> Llantas</label>
        <label><input type="checkbox" id="mech_chk_brakes" /> Frenos</label>
        <label><input type="checkbox" id="mech_chk_lights" /> Luces</label>
        <label><input type="checkbox" id="mech_chk_battery" /> BaterÃ­a</label>
        <label><input type="checkbox" id="mech_chk_fluids" /> Fluidos</label>
      </div>

      <label>Hallazgos / Observaciones</label>
      <textarea id="mech_notes" rows="5"></textarea>
    </div>
  </section>

  <!-- EXPEDIENTE -->
  <section id="viewExpediente" class="view">
    <div class="card">
      <h2>ğŸ—‚ï¸ Expediente y hoja de trabajo</h2>

      <div class="tabs">
        <button id="tabRun" class="tab active" type="button">Run Report</button>
        <button id="tabVitals" class="tab" type="button">Vital Signs</button>
      </div>

      <div id="panelRun" class="panel active">
        <div class="grid2">
          <div><label>Run #</label><input id="run_number" /></div>
          <div><label>Fecha</label><input id="run_date" type="date" /></div>
          <div><label>Hora</label><input id="run_time" type="time" /></div>
          <div><label>Unidad</label><input id="run_unit" /></div>
          <div><label>Paciente</label><input id="run_patient" /></div>
          <div><label>Edad</label><input id="run_age" type="number" /></div>
        </div>
        <label>DescripciÃ³n</label>
        <textarea id="run_desc" rows="6"></textarea>
      </div>

      <div id="panelVitals" class="panel">
        <div class="row wrap">
          <button id="vit_addRow" class="secondary" type="button">â• Agregar toma</button>
          <button id="vit_clear" class="secondary" type="button">ğŸ§¹ Limpiar</button>
        </div>
        <div class="tableWrap">
          <table id="vit_table">
            <thead>
              <tr>
                <th>Hora</th><th>PA</th><th>FC</th><th>FR</th><th>SpO2</th><th>Temp</th><th>GCS</th><th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </div>
  </section>

  <!-- USUARIOS / ROLES -->
  <section id="viewUsers" class="view">
    <div class="card">
      <h2>ğŸ‘¥ Usuarios y permisos</h2>
      <p class="muted">Solo el rol <b>admin</b> puede crear usuarios y cambiar roles.</p>

      <div class="card subcard">
        <h3>Crear usuario</h3>
        <div class="grid2">
          <div>
            <label>Email</label>
            <input id="usr_email" type="email" placeholder="juanito@dominio.com" data-permission="manage_users" />
          </div>
          <div>
            <label>ContraseÃ±a temporal</label>
            <input id="usr_pass" type="text" placeholder="Temporal (ej: 123456)" data-permission="manage_users" />
          </div>
          <div>
            <label>Rol</label>
            <select id="usr_role" data-permission="manage_users">
              <option value="user">user (normal)</option>
              <option value="admin">admin</option>
            </select>
          </div>
          <div style="display:flex; align-items:flex-end; gap:10px">
            <button id="btnCreateUser" class="primary" type="button" data-permission="manage_users">â• Crear</button>
            <button id="btnSendReset" class="secondary" type="button" data-permission="manage_users">ğŸ“© Enviar reset</button>
          </div>
        </div>
        <div id="usr_msg" class="msg"></div>
      </div>

      <div class="card subcard">
        <h3>Lista de usuarios</h3>
        <div class="row">
          <button id="btnUsersRefresh" class="secondary" type="button" data-permission="manage_users">Actualizar</button>
        </div>
        <div class="tableWrap">
          <table id="users_table">
            <thead>
              <tr>
                <th>UID</th>
                <th>Email</th>
                <th>Rol</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="hint muted">Tip: si cambias un rol, la persona debe cerrar sesiÃ³n y volver a entrar para que se apliquen permisos en pantalla.</div>
      </div>
    </div>
  </section>

  <script type="module" src="app.js"></script>
</body>
</html>
